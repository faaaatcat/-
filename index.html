<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É!</h1>
    <form method="post" id="form">
      <div class="row">
        <label>üôÇ –ò–º—è </label>
        <input type="text" name="name" placeholder="" required autofocus autocomplete="off" minlength="2" maxlength="20" title="–∫–∞–∫ –∫ –í–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?" />
      </div>

      <div class="row">
        <label>üìß email</label>
        <input type="text" name="email" placeholder="—á—Ç–æ@—Ç–æ.ru" required autocomplete="off" maxlength="40" title="–º—ã –Ω–∞–ø–∏—à–µ–º —Å—é–¥–∞" />
      </div>

      <div class="row">
        <label>ü§ô —Ç–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="text" name="phone" placeholder="+7..." required autocomplete="off" minlength="10" maxlength="12"  title="–∏–ª–∏ –≤ Telegram/WhatsApp" />
      </div>

      <div class="row">
        <textarea
          name="message"
          maxlength="100"
          id="message"
          cols="30"
          rows="4"
          placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ"
          title="—É—Ç–æ—á–Ω–∏—Ç–µ, —á–µ–º —è –º–æ–≥—É –±—ã—Ç—å –≤–∞–º –ø–æ–ª–µ–∑–µ–Ω?"
        ></textarea>
      </div>

<!--        <div class="row">
        <select
          name="category"
          maxlength="100"
          id="category"          
        >
          <option disabled>–≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
          <option value="1">–∑–∞–ø—Ä–æ—Å</option>
          <option value="2">–∑–∞–º–µ—á–∞–Ω–∏–µ</option>
          <option value="3">–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å</option>          
        </select>
      </div> -->

      
      <div class="row">
        <input type="checkbox" name="rule" id="rule" checked required />
        <label for="rule">–°–æ–≥–ª–∞—Å–Ω—ã –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
      </div>

      <div class="row">
        <input type="submit" value="üëâ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å"/>
      </div>
    </form>

    <script>
              // –≤ —ç—Ç—É –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –ø–æ–º–µ—â–∞–µ–º URL —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Google Apps Script
      // –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥—Ä–µ—Å –í–ê–®–ï–ì–û –†–ê–ó–í–ï–†–ù–£–¢–û–ì–û –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
      // –¢–ï–ö–£–©–ò–ô URL_APP –ø—Ä–∏–≤–µ–¥—ë–Ω –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
     const URL_APP =     "https://script.google.com/macros/s/AKfycbxvlC0xc5GOE8j_uDzMIEZ2IqwOQI_vTp0kHF9DCufghxBbukthm_M1rczX6mQYmRhI/exec";


// –Ω–∞—Ö–æ–¥–∏–º —Ñ–æ—Ä–º—É –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
const form = document.querySelector("#form");

// —É–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã (–Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–∏–º–µ—Ä–∞)
form.action = URL_APP;

// –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
function isFilled(details) {
  const { name, email, phone, rule, category } = details;
  if (!name) return false;
  if (!email) return false;
  if (!phone) return false;
  if (!rule) return false;
  if (!category) return false;
  return true;
}

// –Ω–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
form.addEventListener("submit", async (ev) => {
  // –æ—Ç–º–µ–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  ev.preventDefault();

  // –ø–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
  const name = document.querySelector("[name=name]");
  const email = document.querySelector("[name=email]");
  const phone = document.querySelector("[name=phone]");
  const message = document.querySelector("[name=message]");
  const rule = document.querySelector("[name=rule]");
  //const category = document.querySelector("[name=category]");

  // —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã
  let details = {
    name: name.value.trim(),
    email: email.value.trim(),
    phone: phone.value.trim(),
    message: message.value.trim(),
    rule: rule.checked,
    //category: category.value.trim(),
  };

  // –µ—Å–ª–∏ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã - –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
  if (!isFilled(details)) return;

  // –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
  let formBody = [];
  for (let property in details) {
    // –∫–æ–¥–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    let encodedKey = encodeURIComponent(property);
    let encodedValue = encodeURIComponent(details[property]);
    formBody.push(encodedKey + "=" + encodedValue);
  }
  // —Å–∫–ª–µ–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
  formBody = formBody.join("&");

  // –≤—ã–ø–æ–ª–Ω—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ Google Apps
  const result = await fetch(URL_APP, {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
    },
    //cors: "no-cors", <- —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
    mode: "cors", //<- –æ—Å—Ç–∞–≤–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    body: formBody,
  })
    .then((res) => res.json())
    .catch((err) => alert("–û—à–∏–±–∫–∞!"))
    // .then((res) => console.log(res));
    
   if( result.type === 'success' ) {
      name.value = '';
      email.value = '';
      phone.value = '';
      message.value = '';
     alert('–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞—è–≤–∫—É!')
   }
   if( result.type === 'error' ) {            
     alert(`–û—à–∏–±–∫–∞( ${result.errors}`)
   }


});
    </script>
</body>
</html>